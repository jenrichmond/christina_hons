---
title: "read_data"
author: "Jen Richmond"
date: "16/02/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The point of this Rmd is to try and reproduce the cleaning process outlined in the first script /scripts/kidwell_et_al.(2016)/Actual Availability, All Journals.R

# load packages
```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
library(janitor)
```

# read data

The script above reads data straight from OSF (clever) but I wrote it to the data_files folder to make it easy to read back in. 

```{r}
kidwell <- read_csv(here("data_files", "master_dataset.csv")) %>%
  clean_names()

```

# remove articles that are not empirical

```{r}
empirical_kidwell <- kidwell %>%
  filter(number_of_experiments > 0)
```

# assign journal name

Found this case_when + str_detect  combo came from https://bookdown.org/ansellbr/WEHI_tidyR_course_book/manipulating-data-with-dplyr.html#

```{r eval = FALSE}

empirical_kidwell <- empirical_kidwell %>%
  mutate(journal = case_when(str_detect(article_id_number,'PS') ~ "Psychological Science", 
                             str_detect(article_id_number,'CPS') ~ "Clinical Psychological Science", 
                             str_detect(article_id_number,'DP') ~ "Developmental Psychology", 
                             str_detect(article_id_number,'JEPLMC') ~ "Journal of Experimental Psychology: Learning, Memory, and Cognition", 
                             str_detect(article_id_number,'JPSP') ~ "Journal of Personality and Social Psychology", 
                                      TRUE ~ "other")) %>%
  relocate(journal, .after = article_id_number)

unique(empirical_kidwell$journal)


```

hmmm check whether there are JPSP and CPS in this dataset--- ahhh there are, BUT because str_detect is looking for "PS" they get coded as PsychScience.

I wonder if the order makes a difference. 

```{r}
empirical_kidwell %>%
  filter(str_detect(article_id_number, "JPSP"))

empirical_kidwell %>%
  filter(str_detect(article_id_number, "CPS"))
```

Try this case_when with PS last ... ahhh that works better. case_when is an ordered function. 
```{r}
empirical_kidwell <- empirical_kidwell %>%
  mutate(journal = case_when( 
                             str_detect(article_id_number,'CPS') ~ "Clinical Psychological Science", 
                             str_detect(article_id_number,'DP') ~ "Developmental Psychology", 
                             str_detect(article_id_number,'JEPLMC') ~ "Journal of Experimental Psychology: Learning, Memory, and Cognition", 
                             str_detect(article_id_number,'JPSP') ~ "Journal of Personality and Social Psychology", 
                             str_detect(article_id_number,'PS') ~ "Psychological Science",
                                      TRUE ~ "other")) %>%
  mutate(year = case_when( 
                             str_detect(article_id_number,'2012') ~ "2012", 
                             str_detect(article_id_number,'2013') ~ "2013", 
                             str_detect(article_id_number,'2014') ~ "2014", 
                             str_detect(article_id_number,'2015') ~ "2015", 
                             TRUE ~ "other")) %>%
  relocate(journal, .after = article_id_number) %>%
  relocate(year, .before = article_id_number)

unique(empirical_kidwell$journal)
unique(empirical_kidwell$year)

```

# open access data

filter for links to repo, personal, third party site. 
```{r}
openaccess_data <- empirical_kidwell %>%
  filter(data_url_links_to %in% c("Independent archive / repository", "Personal site", "Third party site"))

```

# for loop

for loop to see within each year how many article received data badge and if they were found at their location. 

key variables in the loop
- Did.the.article.receive.a.badge.for.open.data
- Are.the.data.located.at.the.working.page


```{r}
loop <- openaccess_data %>%
  select(1:6, did_the_article_receive_a_badge_for_open_data, are_the_data_located_at_the_working_page) %>%
  rename(badge = did_the_article_receive_a_badge_for_open_data, located = are_the_data_located_at_the_working_page)

located <- loop %>%
  group_by(year, journal, badge) %>%
  count(located) %>%
  arrange(year, journal)
```

